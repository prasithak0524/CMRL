<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Attendance Reports</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f9fc;
      margin: 0;
      padding: 0;
      color: #333;
    }
    .topbar{
      background:#fff;
      display:flex;
      align-items:center;
      padding:18px 28px;
      box-shadow: 0 1px 0 rgba(0,0,0,0.04);
    }
    header {
      background: #fff;
      padding: 12px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #e0e0e0;
    }
    nav {
      display: flex;
      align-items: center;
      gap: 25px;
    }
    nav a {
      text-decoration: none;
      color: #333;
      font-size: 14px;
      font-weight: 500;
    }
    .user img {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      object-fit: cover;
    }
    main {
      padding: 30px;
    }
    h2 { margin-bottom: 8px; }
    p.subtitle { color: #666; margin-bottom: 25px; }
    .filters {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #ddd;
      margin-bottom: 25px;
    }
    .filters h3 { margin-bottom: 15px; font-size:16px; }
    .filters-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 15px;
    }
    .filters label {
      font-size: 13px;
      display: block;
      margin-bottom: 6px;
      color: #555;
    }
    .filters input, .filters select {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .filters .actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 10px;
    }
    .filters button {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    .filters .reset { background: #f3f3f3; color: #333; }
    .filters .generate { background: #2b6cb0; color: #fff; }
    .report-section {
      background: #fff;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    .report-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
    table th, table td {
      text-align: left;
      padding: 10px;
      border-bottom: 1px solid #eee;
      font-size: 14px;
    }
    table th { background: #f8f9fb; font-weight: 600; }
    .status-present { color: green; font-weight: bold; }
    .status-absent { color: red; font-weight: bold; }
    .status-late { color: #d4a017; font-weight: bold; }
    .brand{display:flex;align-items:center;gap:12px;}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <span style="font-size:20px;">ðŸ§Š</span>
      <div class="title">HR Management</div>
    </div>
    <div class="top-actions"></div>
    <nav style="margin-left: auto;">
      <a href="#">Dashboard</a>
      <a href="#">Attendance</a>
      <a href="#">Leaves</a>
      <a href="#">Reports</a>
      <a href="#">Settings</a>
    </nav>
    <span>ðŸ””</span>
    <img src="https://via.placeholder.com/34" alt="User">
  </header>

  <main class="page">
    <h2>Attendance Reports</h2>
    <p class="subtitle">Generate and view detailed attendance reports for all employees.</p>

    <div class="filters">
      <h3>Filters</h3>
      <div class="filters-row">
        <div>
          <label>Start Date</label>
          <input type="date" id="startDate">
        </div>
        <div>
          <label>End Date</label>
          <input type="date" id="endDate">
        </div>
        <div>
          <label>Employee</label>
          <select id="empIdDropdown">
            <option value="">All Employees</option>
          </select>
        </div>
        <div>
          <label>Department</label>
          <select id="departmentSelect">
            <option>All Departments</option>
            <option>Marketing</option>
            <option>IT</option> 
            <option>Finance</option>
            <option>HR</option>
          </select>
        </div>
      </div>
      <div class="actions">
        <button class="reset">â†© Reset</button>
        <button class="generate">ðŸ“Š Generate Report</button>
      </div>
    </div>

    <div class="report-section">
      <div class="report-header">
        <h3>Report Details</h3>  
        <div>
          <button>ðŸ“Š Export CSV</button>
          <button>ðŸ“„ Export PDF</button>
        </div>
      </div>
      <p>Showing results for January 2025</p>
      <table>
        <thead>
          <tr>
            <th>EMPLOYEE</th>
            <th>DATE</th>
            <th>STATUS</th>
            <th>LATE ARRIVED HRS</th>
            <th>HOURS WORKED</th>
            <th>DISCREPANCIES</th>
          </tr>
        </thead>
      </table>
    </div>
  </main>

  <script>
    // Load employee dropdown
    async function loadEmployeeIds() {
      try {
        const res = await fetch("http://localhost:3000/api/employees");
        const employees = await res.json();
        const empDropdown = document.getElementById("empIdDropdown");
        employees.forEach(emp => {
          const opt = document.createElement("option");
          opt.value = emp.EmpId;
          opt.textContent = emp.EmpId + " - " + emp.Name;
          empDropdown.appendChild(opt);
        });
      } catch (err) {
        console.error("Error loading employee IDs:", err);
      }
    }
    loadEmployeeIds();

    // Generate Report
    document.querySelector(".generate").addEventListener("click", async () => {
      const startDate = document.getElementById("startDate").value;
      const endDate = document.getElementById("endDate").value;
      const empId = document.getElementById("empIdDropdown").value;
      const department = document.getElementById("departmentSelect").value;

      try {
        const res = await fetch(`http://localhost:3000/api/attendance-reports?startDate=${startDate}&endDate=${endDate}&empId=${empId}&department=${department}`);
        const data = await res.json();

        const tbody = document.createElement("tbody");
        if (data.length === 0) {
          tbody.innerHTML = `<tr><td colspan="6" style="text-align:center;">No data found</td></tr>`;
        } else {
          data.forEach(row => {
            tbody.innerHTML += `
              <tr>
                <td>${row.EmpId} - ${row.Name}</td>
                <td>${row.Date}</td>
                <td class="status-${row.Status.toLowerCase()}">${row.Status}</td>
                <td>${row.LateHours || "-"}</td>
                <td>${row.WorkedHours || "-"}</td>
                <td>${row.Discrepancies || "-"}</td>
              </tr>
            `;
          });
        }

        const table = document.querySelector("table");
        const oldTbody = table.querySelector("tbody");
        if (oldTbody) oldTbody.remove();
        table.appendChild(tbody);

      } catch (err) {
        console.error("Error fetching report:", err);
        alert("Failed to fetch report. Check console for errors.");
      }
    });

    // Reset filters
    document.querySelector(".reset").addEventListener("click", () => {
      document.getElementById("startDate").value = "";
      document.getElementById("endDate").value = "";
      document.getElementById("empIdDropdown").value = "";
      document.getElementById("departmentSelect").value = "";
    });
  </script>
</body>
</html>
